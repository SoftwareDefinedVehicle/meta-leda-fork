find_package(CURL REQUIRED)
find_package(PkgConfig REQUIRED)
# find_package(spdlog REQUIRED)
find_package(nlohmann_json REQUIRED)
find_package(PahoMqttCpp REQUIRED)


configure_file(${CMAKE_CURRENT_SOURCE_DIR}/version.h.in ${CMAKE_CURRENT_BINARY_DIR}/include/version.h @ONLY)


include_directories(
    ${CMAKE_SOURCE_DIR}/src
    ${CMAKE_SOURCE_DIR}/3rdparty/spdlog/include
    ${CMAKE_SOURCE_DIR}/3rdparty/mini-yaml
    ${CMAKE_CURRENT_BINARY_DIR}/include
)


pkg_search_module(GLIB REQUIRED glib-2.0)
pkg_search_module(GLIB REQUIRED gobject-2.0)

include_directories(${GLIB_INCLUDE_DIRS})
link_directories(${GLIB_LIBRARY_DIRS})


file(GLOB_RECURSE SRCS *.cpp *.h)
add_definitions(${GLIB_CFLAGS_OTHER})
add_executable(${CMAKE_PROJECT_NAME} ${SRCS})


target_link_libraries(${PROJECT_NAME}
    PUBLIC
        mini-yaml
        resolv
        blkid
        ${GLIB_LIBRARIES}
        curl
        gio-2.0
        gobject-2.0
        paho-mqtt3a
        paho-mqttpp3
)
#     PRIVATE
#         spdlog::spdlog_header_only
# )


install(TARGETS ${CMAKE_PROJECT_NAME} RUNTIME DESTINATION bin)
